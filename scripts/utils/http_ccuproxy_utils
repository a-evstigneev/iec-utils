json_parse()
{
	local asduaddr class type json parser
	asduaddr=$1
	class="$2"
	json="$3"
	parser=$(cat "$RTU" | awk -v comaddr=$asduaddr '{ if ( $1 == comaddr) print $0 }' | cut -d " " -f 3)

#	archdir="$DB_ARCH/$asduaddr"
#	[ -d "$archdir" ] || mkdir -p "$archdir"

#	tmpfile=$(mktemp -u -p $archdir tmpccu.XXXXXX)
#	[ -f "$tmpfile" ] && rm "$tmpfile" 2>/dev/null
	
	valuelist=$(echo "$json" | $PARSERS/$parser "$asduaddr" "$class")
	case "$class" in
	"events" ) 
		while read id type value; do
			[ -z "$listid" ] && listid=$id || listid="${listid}%2C${id}"
			case "$type" in
			'"Event"' ) true ;;
			* )
				echo "$value" > "$tmpfile"
					
				if sync "$tmpfile" 2>/dev/null; then
					putqueue  "$tmpfile"
					putdbact  "$tmpfile"
					putdbarch "$tmpfile"
					rm "$tmpfile" 2>/dev/null
				else
					rm "$tmpfile" 2>/dev/null
				fi
			;;
			esac
		done <<-EOF
			$valuelist
		EOF
		echo "$listid"
	;;
	"info" )
		echo $valuelist

#		cat - >> "$tmpfile" <<-EOF
#			$valuelist
#		EOF
#		
#		if sync "$tmpfile" 2>/dev/null; then
#			putqueue  "$tmpfile"
#			putdbact  "$tmpfile"
#			putdbarch "$tmpfile"
#			rm "$tmpfile" 2>/dev/null
#		else
#			rm "$tmpfile" 2>/dev/null
#		fi
	;;
	esac
}

get_inputs()
{
	local asduaddr
	asduaddr=$1
	imei=$(cat "$RTU" | awk -v comaddr=$asduaddr '{ if ( $1 == comaddr) print $0 }' | cut -d " " -f 2)

	curl -s -k -N --connect-timeout 15 --fail-early --keepalive --keepalive-time 15 \
		-H 'Authorization: Bearer nokey' "${CCUPROXY}/api/ccu/${imei}/inputs"
}

get_sysinfo()
{
	local asduaddr
	asduaddr=$1
	imei=$(cat "$RTU" | awk -v comaddr=$asduaddr '{ if ( $1 == comaddr) print $0 }' | cut -d " " -f 2)

	curl -s -k -N --connect-timeout 15 --fail-early --keepalive --keepalive-time 15 \
		-H 'Authorization: Bearer nokey' "${CCUPROXY}/api/ccu/${imei}/sysinfo"
}
